<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>è®°å½•æ˜¾ç¤ºæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        pre {
            background: #1a1a1a;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æ‰“å¡è®°å½•æ˜¾ç¤ºè¯Šæ–­å·¥å…·</h1>

    <div class="test-section">
        <h2>æ­¥éª¤1ï¼šæ·»åŠ æµ‹è¯•è®°å½•</h2>
        <button onclick="addRecord()">æ·»åŠ ä¸€æ¡æµ‹è¯•è®°å½•</button>
        <button onclick="add5Records()">æ·»åŠ 5æ¡æµ‹è¯•è®°å½•</button>
        <div id="addResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤2ï¼šæŸ¥çœ‹å­˜å‚¨çš„è®°å½•</h2>
        <button onclick="checkStorage()">æ£€æŸ¥localStorage</button>
        <div id="storageResult"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤3ï¼šæµ‹è¯•æ—¥æœŸè¿‡æ»¤</h2>
        <button onclick="testDateFilter()">æµ‹è¯•ä»Šæ—¥è®°å½•è¿‡æ»¤</button>
        <div id="filterResult"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤4ï¼šæµ‹è¯•HTMLæ¸²æŸ“</h2>
        <button onclick="testRender()">æµ‹è¯•è®°å½•æ¸²æŸ“</button>
        <div id="renderResult"></div>
        <div id="renderDemo"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤5ï¼šæ‰“å¼€ä¸»é¡µé¢æµ‹è¯•</h2>
        <p>å¦‚æœä»¥ä¸Šæµ‹è¯•éƒ½é€šè¿‡ï¼Œé—®é¢˜å¯èƒ½åœ¨CSSæˆ–åˆå§‹åŒ–ã€‚</p>
        <a href="index.html" target="_blank">
            <button>åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ä¸»åº”ç”¨</button>
        </a>
    </div>

    <script>
        const STORAGE_KEY = 'ruthirsty_records';

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function getRecords() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                return [];
            }
        }

        function saveRecords(records) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        }

        function addRecord() {
            const now = new Date();
            const record = {
                id: Date.now(),
                timestamp: now.toISOString(),
                date: formatDate(now),
                time: formatTime(now)
            };

            let records = getRecords();
            records.unshift(record);
            saveRecords(records);

            const resultDiv = document.getElementById('addResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <strong>âœ… è®°å½•å·²æ·»åŠ </strong><br>
                æ—¶é—´: ${record.time}<br>
                æ—¥æœŸ: ${record.date}<br>
                æ€»è®°å½•æ•°: ${records.length}
            `;

            console.log('æ·»åŠ çš„è®°å½•:', record);
        }

        function add5Records() {
            for(let i = 0; i < 5; i++) {
                setTimeout(() => addRecord(), i * 200);
            }
        }

        function checkStorage() {
            const records = getRecords();
            const resultDiv = document.getElementById('storageResult');

            if (records.length === 0) {
                resultDiv.innerHTML = `
                    <div class="result" style="border-color: orange;">
                        âš ï¸ localStorageä¸­æ²¡æœ‰è®°å½•<br>
                        è¯·å…ˆç‚¹å‡»"æ·»åŠ æµ‹è¯•è®°å½•"
                    </div>
                `;
                return;
            }

            const today = formatDate(new Date());
            const todayRecords = records.filter(r => r.date === today);

            resultDiv.innerHTML = `
                <div class="result" style="border-color: green;">
                    <strong>âœ… localStorageæ£€æŸ¥é€šè¿‡</strong><br>
                    æ€»è®°å½•æ•°: ${records.length}<br>
                    ä»Šæ—¥è®°å½•æ•°: ${todayRecords.length}<br>
                    ä»Šæ—¥æ—¥æœŸ: ${today}
                </div>
                <h3>æœ€è¿‘5æ¡è®°å½•ï¼š</h3>
                <pre>${JSON.stringify(records.slice(0, 5), null, 2)}</pre>
            `;
        }

        function testDateFilter() {
            const records = getRecords();
            const today = formatDate(new Date());
            const todayRecords = records.filter(r => r.date === today);

            const resultDiv = document.getElementById('filterResult');

            console.log('ä»Šæ—¥æ—¥æœŸ:', today);
            console.log('æ‰€æœ‰è®°å½•:', records);
            console.log('ä»Šæ—¥è®°å½•:', todayRecords);

            resultDiv.innerHTML = `
                <div class="result">
                    <strong>æ—¥æœŸè¿‡æ»¤æµ‹è¯•</strong><br>
                    å½“å‰æ—¥æœŸ: ${today}<br>
                    æ€»è®°å½•: ${records.length} æ¡<br>
                    ä»Šæ—¥è®°å½•: ${todayRecords.length} æ¡<br>
                    <br>
                    ${todayRecords.length > 0 ? 'âœ… è¿‡æ»¤æˆåŠŸ' : 'âŒ æ²¡æœ‰ä»Šæ—¥è®°å½•æˆ–è¿‡æ»¤å¤±è´¥'}
                </div>
                ${todayRecords.length > 0 ? `
                    <h3>ä»Šæ—¥è®°å½•è¯¦æƒ…ï¼š</h3>
                    <pre>${JSON.stringify(todayRecords, null, 2)}</pre>
                ` : ''}
            `;
        }

        function testRender() {
            const records = getRecords();
            const today = formatDate(new Date());
            const todayRecords = records.filter(r => r.date === today);

            const resultDiv = document.getElementById('renderResult');
            const demoDiv = document.getElementById('renderDemo');

            if (todayRecords.length === 0) {
                resultDiv.innerHTML = `
                    <div class="result" style="border-color: orange;">
                        âš ï¸ æ²¡æœ‰ä»Šæ—¥è®°å½•å¯ä»¥æ¸²æŸ“<br>
                        è¯·å…ˆæ·»åŠ æµ‹è¯•è®°å½•
                    </div>
                `;
                return;
            }

            // ç”ŸæˆHTML
            let html = '<div style="background: #f5f5f5; padding: 15px; border-radius: 8px;">';
            html += '<h3>æ¨¡æ‹Ÿçš„è®°å½•åˆ—è¡¨ï¼š</h3>';
            todayRecords.forEach((record, index) => {
                html += `
                    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2em;">ğŸ’§</div>
                        <div style="flex: 1;">
                            <div style="font-size: 1.2em; font-weight: bold;">${record.time}</div>
                            <div style="color: #666;">${record.date}</div>
                        </div>
                        <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">#${todayRecords.length - index}</div>
                    </div>
                `;
            });
            html += '</div>';

            resultDiv.innerHTML = `
                <div class="result" style="border-color: green;">
                    âœ… HTMLæ¸²æŸ“æˆåŠŸ<br>
                    æ¸²æŸ“äº† ${todayRecords.length} æ¡è®°å½•
                </div>
            `;

            demoDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            console.log('è¯Šæ–­é¡µé¢å·²åŠ è½½');
            console.log('localStorageå¯ç”¨:', typeof(Storage) !== "undefined");
        };
    </script>
</body>
</html>
